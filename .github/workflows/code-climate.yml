name: Code Climate

on:
  workflow_run:
    workflows: ["Test"]
    # avoid running once merged on main branch, this should be run only on PRs
    branches-ignore: ["main"]
    # run this once one of the workflow is triggered.
    types:
      - requested

jobs:
  code-climate:
    name: Set up
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout PR head
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.workflow_run.head_sha }}

      # - name: Download and Extract Artifacts
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #   run: |
      #      mkdir -p artifacts && cd artifacts
      #      artifacts_url=${{ github.event.workflow_run.artifacts_url }}
      #      gh api "$artifacts_url" -q '.artifacts[] | [.name, .archive_download_url] | @tsv' | while read artifact
      #      do
      #        IFS=$'\t' read name url <<< "$artifact"
      #        if  [[ $name == "Event File"* ]]; then
      #            name="Event File"
      #        fi
      #        gh api $url > "$name.zip"
      #        unzip -d "$name" "$name.zip"
      #      done
